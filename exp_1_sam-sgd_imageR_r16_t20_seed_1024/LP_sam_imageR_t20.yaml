prefix: PerTaskLP_sam_imager_t20_1024
memory_size: 0
memory_per_class: 0
fixed_memory: false

#----------- Dataset ---------------- 
dataset: "imagenetr"     
# dataset: "tiny_imagenetp"
# dataset: "tiny_imagenetc"


# task divided
class_shuffle: true
total_sessions: 20 
init_cls: 10
increment: 10
nb_tasks: 20

seed:
  - 1024
  # - 521
  # - 2048
  # - 1993
  # - 42

all_or_inc: inc

backbone_type: vit_base_patch16_224

device:
  - "5"


#---------- Method --------
model_name: linearprobe

#---------- Train --------
batch_size: 128

# optimizer
optimizer: "sgd"
optimizer_type: "sam"
sam_rho: 0.05
sam_adaptive: false

scheduler: cosine # "constant"
init_epoch: 20
init_lr: 0.01
init_momentum: 0
init_weight_decay: 0

epochs: 20
lrate: 0.01
momentum: 0
weight_decay: 0


#---------------------------- For evaluation ------------------------------------


#-------------- # Linear Probe Evaluation ------------------
linear_probe_eval_num_workers: 0
linear_probe_softmax_joint_seen_eval: true
linear_probe_softmax_per_task_eval: true
probe_train_mode: train
probe_test_mode: test

probe_fit_epochs: 20       
probe_fit_lr: 0.015
probe_fit_moment: 0 
probe_fit_wd: 0.0005
probe_fit_train_batch_size: 128


#-------------- #  Weight Flatness ------------------
flat_eval: true
flat_eval_batch_size: 32
flat_eval_dataset_fraction: 0.1
# First and zero order Sharpness definition
flat_eval_sharpness_radius: 0.05
# E-sh definition
flat_eval_esh_gaussian_std: null
flat_eval_esh_samples: 100  
# Hessian 
flat_eval_hessian_power_iters: 100   
flat_eval_hessian_trace_samples: 100  
#  Loss landscape
weight_loss_land_1d: true
weight_loss_land_2d: true
weight_loss_land_radius: 1            
weight_loss_land_num_points: 41
weight_loss_land_filter_norm: true     
loss_land_modes: "full"
loss_land_basis: "random"
eig_save_vectors: false                   


#-------------- # Feature Roubtness（EFM）------------------
feature_flat_eval: true
feature_flat_topk: 200
feature_flat_eps: 1e-12
feature_flat_rank_tol: 1e-06
feature_flat_save_path: null
# CKA eval
feature_cka_eval: true
feature_cka_max_batches: 32
feature_cka_max_samples: 2048
feature_sep_max_samples: 2048
feature_margin_max_samples: 4096
# Prptotype drift
feature_proto_eval: true
feature_proto_max_batches: 32
feature_proto_max_samples: 2048

# for attention probe
attention_probe_eval: false

